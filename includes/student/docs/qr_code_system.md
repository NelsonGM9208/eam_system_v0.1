# QR Code System for Event Registration

## Overview
The QR code system is designed to streamline event registration by allowing students to quickly register for events using their mobile device's camera to scan QR codes displayed at event locations.

## QR Code Format
The QR codes used in the system follow this format:
```
EVENT_{EVENT_ID}_{TIMESTAMP}
```

### Example QR Code Content:
```
EVENT_123_1694567890
```

### Breakdown:
- **EVENT_**: Fixed prefix to identify event registration QR codes
- **123**: The actual event ID from the database
- **1694567890**: Unix timestamp when the QR code was generated

## How It Works

### 1. QR Code Generation
- QR codes are generated by event organizers/admins
- Each QR code contains the event ID and generation timestamp
- QR codes are displayed at event locations (on posters, screens, etc.)

### 2. Student Registration Process
1. **Student opens registration modal** for an event
2. **Camera access is requested** for QR code scanning
3. **Student points camera** at the QR code displayed at the event location
4. **System automatically detects** and processes the QR code
5. **Registration is completed** if the QR code is valid

### 3. QR Code Validation
The system validates QR codes by:
- **Format check**: Must start with "EVENT_"
- **Event ID validation**: Must match a valid, approved event
- **Access control**: Student must have access to the event (Open or Exclusive with section access)
- **Registration status**: Student must not already be registered

### 4. Fallback Options
If camera scanning fails, students can:
- **Manual entry**: Type the QR code content manually
- **Alternative registration**: Contact event organizers for assistance

## Security Features

### 1. Access Control
- **Open Events**: Any student can register
- **Exclusive Events**: Only students in invited sections can register
- **Approved Events**: Only events with "Approved" status can be registered for

### 2. Duplicate Prevention
- System checks if student is already registered
- Prevents multiple registrations for the same event

### 3. Event Validation
- QR codes must reference valid, existing events
- Events must be in "Upcoming" status for registration
- Events must be approved by administrators

## Technical Implementation

### 1. Camera Integration
```javascript
// Request camera access
navigator.mediaDevices.getUserMedia({ 
    video: { 
        facingMode: 'environment', // Use back camera
        width: { ideal: 1280 },
        height: { ideal: 720 }
    } 
})
```

### 2. QR Code Processing
```javascript
function processQRCode(qrData) {
    // Validate format
    if (qrData.startsWith('EVENT_')) {
        const eventIdFromQR = qrData.split('_')[1];
        
        // Validate event ID matches current event
        if (eventIdFromQR == currentEventId) {
            completeRegistration();
        } else {
            showError('Invalid QR code for this event.');
        }
    } else {
        showError('Invalid QR code format.');
    }
}
```

### 3. Database Registration
```php
// Create attendance record for registration
$insert_query = "INSERT INTO attendance (student_id, event_id, check_in_time, remark) 
                 VALUES (?, ?, ?, 'Present')";
```

## User Experience Flow

### 1. Event Discovery
- Student browses available events
- Sees events they can register for (Open or Exclusive with access)

### 2. Registration Initiation
- Student clicks "Register" button on event card
- Registration modal opens with event details

### 3. Information Verification
- Student's information is displayed for verification
- Includes: Name, Student ID (MIS ID), LRN, Section

### 4. QR Code Scanning
- Camera activates for QR code scanning
- Student points camera at event QR code
- System automatically processes valid QR codes

### 5. Registration Confirmation
- Success message displayed
- Registration record created in database
- Student can now attend the event

## Error Handling

### 1. Camera Access Issues
- **Permission denied**: Show manual entry option
- **No camera**: Provide manual entry fallback
- **Camera error**: Display error message with alternatives

### 2. QR Code Issues
- **Invalid format**: Show format error message
- **Wrong event**: Show event mismatch error
- **Already registered**: Show registration status

### 3. Network Issues
- **Connection problems**: Show retry options
- **Server errors**: Display error message with contact info

## Best Practices

### 1. For Event Organizers
- **Display QR codes prominently** at event locations
- **Ensure QR codes are clearly visible** and not damaged
- **Provide backup registration methods** for technical issues
- **Test QR codes** before events

### 2. For Students
- **Allow camera permissions** when prompted
- **Ensure good lighting** when scanning QR codes
- **Keep QR code in frame** until registration completes
- **Use manual entry** if camera scanning fails

### 3. For System Administrators
- **Monitor registration success rates**
- **Track QR code usage statistics**
- **Provide technical support** for registration issues
- **Maintain event and student data accuracy**

## Future Enhancements

### 1. Advanced Features
- **Offline QR code validation**
- **Batch registration** for multiple events
- **QR code expiration** for security
- **Analytics dashboard** for registration tracking

### 2. Integration Options
- **Mobile app integration**
- **SMS/Email notifications**
- **Calendar integration**
- **Social media sharing**

## Troubleshooting

### Common Issues:
1. **QR code not scanning**: Check lighting and camera focus
2. **"Invalid QR code" error**: Verify QR code format and event ID
3. **"Already registered" error**: Check registration status
4. **Camera not working**: Try manual entry or different device
5. **Registration failed**: Check internet connection and try again

### Support:
- Contact system administrators for technical issues
- Check event details for registration requirements
- Verify student account status and section enrollment
